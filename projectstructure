# NPDateTime Unified Project Structure

Combining lookup tables (fast, accurate) with astronomical calculations (future-proof, educational).

## ğŸ“ Complete Directory Structure

```
npdatetime-rust/
â”œâ”€â”€ Cargo.toml                    # Fixed configuration
â”œâ”€â”€ build.rs                      # Compile-time CSV â†’ Rust conversion
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ .gitignore
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ calendar_bs.csv           # Source of truth (2000-2090 BS)
â”‚   â”œâ”€â”€ calendar_bs.json          # Generated for reference
â”‚   â””â”€â”€ validation/
â”‚       â”œâ”€â”€ known_events.json     # Known Sankranti dates for validation
â”‚       â””â”€â”€ test_cases.csv        # Test cases for both methods
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs                    # Main library entry
â”‚   â”‚
â”‚   â”œâ”€â”€ lookup/                   # Fast lookup table approach
â”‚   â”‚   â”œâ”€â”€ mod.rs                # Lookup module
â”‚   â”‚   â”œâ”€â”€ data.rs               # Embedded calendar data
â”‚   â”‚   â”œâ”€â”€ converter.rs          # BS â†” AD conversion
â”‚   â”‚   â””â”€â”€ compressed.rs         # Optional: compressed storage
â”‚   â”‚
â”‚   â”œâ”€â”€ astronomical/             # Astronomical calculation approach
â”‚   â”‚   â”œâ”€â”€ mod.rs                # Astronomical module
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.rs      # Astronomical constants
â”‚   â”‚   â”‚   â””â”€â”€ time.rs           # Julian Day, time conversions
â”‚   â”‚   â”œâ”€â”€ solar/
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ position.rs       # Sun position (VSOP87)
â”‚   â”‚   â”‚   â””â”€â”€ sankranti.rs      # Solar events
â”‚   â”‚   â”œâ”€â”€ lunar/
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ position.rs       # Moon position (ELP-2000)
â”‚   â”‚   â”‚   â””â”€â”€ tithi.rs          # Lunar days
â”‚   â”‚   â””â”€â”€ calendar.rs           # Month length calculator
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # Shared core types
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ date.rs               # NepaliDate struct
â”‚   â”‚   â”œâ”€â”€ datetime.rs           # NepaliDateTime struct
â”‚   â”‚   â”œâ”€â”€ error.rs              # Error types
â”‚   â”‚   â””â”€â”€ format.rs             # Formatting & parsing
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ mod.rs
â”‚       â”œâ”€â”€ validation.rs         # Validation utilities
â”‚       â””â”€â”€ interpolation.rs      # Math utilities
â”‚
â”œâ”€â”€ bindings/
â”‚   â”œâ”€â”€ python/                   # Python bindings (PyO3)
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â”‚   â””â”€â”€ tests/
â”‚   â”‚       â””â”€â”€ test_python.py
â”‚   â”‚
â”‚   â”œâ”€â”€ javascript/               # JavaScript/WASM bindings
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â”‚   â””â”€â”€ examples/
â”‚   â”‚       â””â”€â”€ react-example/
â”‚   â”‚
â”‚   â”‚â”€â”€ java/                     # Java JNI bindings
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â”‚   â””â”€â”€ java/
â”‚   â”‚       â””â”€â”€ NepaliDate.java
â”‚   â”‚
â”‚   â”‚â”€â”€ php/               # PHP bindings
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ lib.rs
â”‚   â”‚   â””â”€â”€ examples/
â”‚   â”‚       â””â”€â”€ example.php
â”‚   â”‚
â”‚
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ basic_usage.rs            # Basic usage with lookup
â”‚   â”œâ”€â”€ conversion_demo.rs        # BS â†” AD conversions
â”‚   â”œâ”€â”€ formatting.rs             # Date formatting
â”‚   â”œâ”€â”€ compare_methods.rs        # Compare lookup vs astronomical
â”‚   â”‚
â”‚   â””â”€â”€ astronomical/             # Astronomical examples
â”‚       â”œâ”€â”€ calculate_sankranti.rs
â”‚       â”œâ”€â”€ calculate_tithi.rs
â”‚       â””â”€â”€ generate_calendar.rs
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ integration_tests.rs      # Integration tests
â”‚   â”œâ”€â”€ lookup_tests.rs           # Lookup table tests
â”‚   â”œâ”€â”€ astronomical_tests.rs     # Astronomical calculation tests
â”‚   â””â”€â”€ validation_tests.rs       # Cross-validation tests
â”‚
â”œâ”€â”€ benches/
â”‚   â”œâ”€â”€ date_conversion.rs        # Benchmark conversions
â”‚   â””â”€â”€ astronomical_bench.rs     # Benchmark calculations
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ api.md                    # API documentation
    â”œâ”€â”€ astronomical_theory.md    # Theory behind calculations
    â””â”€â”€ comparison.md             # Lookup vs Astronomical comparison
```

---

## ğŸ”§ Key Files

### `build.rs` (Compile-time Data Embedding)

```rust
// build.rs
use std::env;
use std::fs::{File, create_dir_all};
use std::io::Write;
use std::path::Path;

fn main() {
    println!("cargo:rerun-if-changed=data/calendar_bs.csv");
    
    let out_dir = env::var("OUT_DIR").unwrap();
    let dest_path = Path::new(&out_dir).join("calendar_data.rs");
    
    // Read CSV and generate Rust code
    let mut reader = csv::Reader::from_path("data/calendar_bs.csv")
        .expect("Failed to read calendar_bs.csv");
    
    let mut data = Vec::new();
    
    for result in reader.records() {
        let record = result.expect("Failed to parse CSV record");
        let year: i32 = record[0].parse().expect("Invalid year");
        let month: u8 = record[1].parse().expect("Invalid month");
        let days: u8 = record[2].parse().expect("Invalid days");
        
        data.push((year, month, days));
    }
    
    // Generate Rust source code
    let mut f = File::create(&dest_path).unwrap();
    
    writeln!(f, "// Auto-generated from calendar_bs.csv").unwrap();
    writeln!(f, "// DO NOT EDIT MANUALLY").unwrap();
    writeln!(f, "").unwrap();
    writeln!(f, "pub const CALENDAR_DATA: &[(i32, u8, u8)] = &[").unwrap();
    
    for (year, month, days) in data {
        writeln!(f, "    ({}, {}, {}),", year, month, days).unwrap();
    }
    
    writeln!(f, "];").unwrap();
    
    println!("cargo:warning=Generated calendar data with {} entries", 
             reader.position().line());
}
```

---

### `src/lib.rs` (Main Entry Point)

```rust
//! NPDateTime - High-performance Nepali (Bikram Sambat) datetime library
//! 
//! This library provides two approaches:
//! 1. **Lookup Tables** (default): Fast, accurate, works offline
//! 2. **Astronomical Calculations** (optional): Future-proof, educational
//! 
//! # Quick Start
//! 
//! ```rust
//! use npdatetime::NepaliDate;
//! 
//! // Create a date
//! let date = NepaliDate::new(2077, 5, 19)?;
//! 
//! // Convert to Gregorian
//! let (year, month, day) = date.to_gregorian()?;
//! 
//! // Format
//! println!("{}", date.format("%Y-%m-%d"));
//! ```

#![cfg_attr(not(feature = "std"), no_std)]
#![cfg_attr(docsrs, feature(doc_cfg))]

// Core modules (always available)
pub mod core;
pub use core::{NepaliDate, NepaliDateTime, NpdatetimeError, Result};

// Lookup table module (default)
#[cfg(feature = "lookup-tables")]
#[cfg_attr(docsrs, doc(cfg(feature = "lookup-tables")))]
pub mod lookup;

// Astronomical calculation module (optional)
#[cfg(feature = "astronomical")]
#[cfg_attr(docsrs, doc(cfg(feature = "astronomical")))]
pub mod astronomical;

// Utilities
pub mod utils;

/// Library version
pub const VERSION: &str = env!("CARGO_PKG_VERSION");

/// Prelude for common imports
pub mod prelude {
    pub use crate::core::{NepaliDate, NepaliDateTime};
    pub use crate::core::NpdatetimeError;
    
    #[cfg(feature = "lookup-tables")]
    pub use crate::lookup::BsCalendar;
    
    #[cfg(feature = "astronomical")]
    pub use crate::astronomical::{SolarCalculator, LunarCalculator};
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_version()